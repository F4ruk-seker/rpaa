<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ManyQuery | nseren</title>
    {% load static %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>analiz</title>
    <link rel="stylesheet" href="{% static "bootstrap/css/bootstrap.min.css" %}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700">
    <link rel="stylesheet" href="{% static "css/Contact-Form-Clean.css" %}">
    <link rel="stylesheet" href="{% static "css/Header-Blue.css" %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css">
    <link rel="stylesheet" href="{% static "css/Newsletter-Subscription-Form.css" %}">
    <link rel="stylesheet" href="{% static "css/Registration-Form-with-Photo.css" %}">
    <link rel="stylesheet" href="{% static "css/styles.css" %}">


</head>
<body class="bg-light">
<header class="border-bottom border-secondary" style="background: var(--bs-body-color);">
        <nav class="navbar navbar-dark navbar-expand-md navigation-clean-search">
            <div class="container-fluid"><a class="navbar-brand" href="{% url 'mainQueryPage' %}">Duygu Analizi</a><button data-bs-toggle="collapse" class="navbar-toggler" data-bs-target="#navcol-1"><span class="visually-hidden">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navcol-1">
                    <ul class="navbar-nav">
                        <li class="nav-item"></li>
                    </ul>
                    <form class="d-flex me-auto navbar-form" target="_self">
                        <div class="d-flex align-items-center"><label class="form-label d-flex mb-0" for="search-field" style="color: var(--bs-light);font-size: 21px;"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icon-tabler-scan">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <path d="M4 7v-1a2 2 0 0 1 2 -2h2"></path>
                                    <path d="M4 17v1a2 2 0 0 0 2 2h2"></path>
                                    <path d="M16 4h2a2 2 0 0 1 2 2v1"></path>
                                    <path d="M16 20h2a2 2 0 0 0 2 -2v-1"></path>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg></label></div>
                    </form><a class="btn btn-light bounce animated action-button btn-info" role="button" href="#connect" style="background: var(--bs-cyan);border-top-width: 0px;border-right-width: 0px;border-right-color: var(--bs-primary);border-bottom-width: 0px;border-left-width: 0px;">iletişime geç</a>
                </div>
            </div>
        </nav>
    </header>
<section>
    <div class="container pt-1">
        <h1>Çoklu sorgu</h1>
        <hr>
    </div>
</section>
<section class="container" style="overflow-y:scroll; max-height: 40vh">
<table class="table table-striped" id="QueryTable">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Comment</th>
      <th scope="col">Result</th>
    </tr>
  </thead>
  <tbody>

  </tbody>
</table>
</section>
<section class="container">
    <div class="d-flex pt-3">
        <input class="form-control w-100" type="text" id="QueryInput" >
        <button class="btn btn-success col-3" type="button" onclick="add_query_to_table()">Ekle</button>
    </div>
    <hr>
    <div>
        <div class="float-end d-flex">
            <button class="btn btn-info fw-bold text-light" onclick="send_query_request_from_data_list()"  type="button">Sorgula</button></div>
    </div>
</section>
<section class="pt-5">
    <div class="container">
        <h4 class="fw-bold" >Results</h4>
        <hr>
        <ul>
            {% for result in result_count %}
            <li>{{ result.result_name }} | {{ result.counter }}</li>
            {% endfor %}
            <hr>
            {{ max_result.result_name }}
            {{ max_result.counter }}
        </ul>
    </div>

</section>
<form method="post" id="QueryForm" style="display: none">
{% csrf_token %}
{{ ManyQueryForm }}
</form>

<script>
    var QuryList = {{ result|safe }};

    console.log(QuryList)

    var input = document.getElementById("QueryInput");
    input.addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        event.preventDefault();
        add_query_to_table();
      }
    });

    function add_query_to_table() {
    var input = document.querySelector('#QueryInput');
    if (input.value !== ""){
        QuryList.push({query:input.value,result:''})
        input.value = '';
        render_table_from_data()
    }

    }
    function send_query_request_from_data_list(){
        var api_url = window.location.href;
        const csrf_token = document.getElementsByName('csrfmiddlewaretoken')[0].defaultValue;
        console.log(QuryList)
        var form = document.getElementById('QueryForm');
        var query_list_input = document.getElementById('id_query_list');
        query_list_input.value = JSON.stringify(QuryList)
        form.submit()
       {#fetch(api_url, {#}
       {#     method: 'POST',#}
       {#     headers: {#}
                {#'Accept': 'application/json',#}
       {#         'Content-Type': 'application/json',#}
       {#         'X-CSRFToken':csrf_token#}
       {#     },#}
       {#     body: JSON.stringify({"query_list":QuryList}.toString())#}
       {# })#}
       {# .then(response => response.json())#}
       {# .then(response => console.log(JSON.stringify(response)))#}
    }

    function render_table_from_data() {
        var table = document.getElementById("QueryTable");
        let tbody = table.getElementsByTagName("tbody")[0];
        tbody.innerHTML = '';
        if (QuryList.length === 0){
            console.log('data is empty')
        }
        for (var i = 0; i < QuryList.length; i++) {
            var row = tbody.insertRow();
            var idCell = row.insertCell(0);
            var queryCell = row.insertCell(1);
            var resultCell = row.insertCell(2);
            idCell.innerHTML = i;
            queryCell.innerHTML = QuryList[i].query;
            resultCell.innerHTML = QuryList[i].result;
        }
    }
    if (QuryList.length>0){
        render_table_from_data()
    }

</script>
</body>
</html>